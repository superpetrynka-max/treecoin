// –ù–æ–≤–∏–π –µ–ª–µ–º–µ–Ω—Ç —Ä–∏–Ω–∫—É: —Å–∫—Ä–∏–Ω—è
const CHEST_PRICE = 50; // —Ü—ñ–Ω–∞ —Å–∫—Ä–∏–Ω—ñ TRS

function buyChest() {
  if (balance < CHEST_PRICE) {
    alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ TRS –¥–ª—è –ø–æ–∫—É–ø–∫–∏ —Å–∫—Ä–∏–Ω—ñ!");
    return;
  }
  balance -= CHEST_PRICE;
  saveGame();
  renderGrid();
  
  // –í–∏–ø–∞–¥–∫–æ–≤–µ –¥–µ—Ä–µ–≤–æ –∑—ñ —Å–∫—Ä–∏–Ω—ñ
  const type = getRandomTree();
  inventory.push({ type });
  renderInventory();

  // –ê–Ω—ñ–º–∞—Ü—ñ—è –≤–∏–ø–∞–¥–∞–Ω–Ω—è –¥–µ—Ä–µ–≤–∞
  const chestAnim = document.createElement("div");
  chestAnim.style.position = "absolute";
  chestAnim.style.top = "50%";
  chestAnim.style.left = "50%";
  chestAnim.style.transform = "translate(-50%, -50%)";
  chestAnim.style.fontSize = "50px";
  chestAnim.style.opacity = 0;
  chestAnim.style.transition = "all 1s ease-out";
  chestAnim.textContent = TREE_TYPES[type].icon;
  document.body.appendChild(chestAnim);

  // –ü–ª–∞–≤–Ω–µ –∑‚Äô—è–≤–ª–µ–Ω–Ω—è —Ç–∞ –ø–∞–¥—ñ–Ω–Ω—è
  setTimeout(() => {
    chestAnim.style.opacity = 1;
    chestAnim.style.transform = "translate(-50%, 0%)";
  }, 100);

  // –ó–Ω–∏–∫–Ω–µ–Ω–Ω—è –ø—ñ—Å–ª—è 2 —Å–µ–∫
  setTimeout(() => {
    chestAnim.style.opacity = 0;
    setTimeout(() => chestAnim.remove(), 1000);
  }, 2000);

  alert("üéÅ –í–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ " + TREE_TYPES[type].name + " " + TREE_TYPES[type].icon);
}

// –î–æ–¥–∞—î–º–æ –∫–Ω–æ–ø–∫—É –∫—É–ø—ñ–≤–ª—ñ —Å–∫—Ä–∏–Ω—ñ –≤ —Ä–∏–Ω–æ–∫
const marketDiv = document.querySelector(".market");
const chestBox = document.createElement("div");
chestBox.classList.add("box");
chestBox.innerHTML = `<button onclick="buyChest()">üéÅ –ö—É–ø–∏—Ç–∏ —Å–∫—Ä–∏–Ω—é (${CHEST_PRICE} TRS)</button>`;
marketDiv.insertBefore(chestBox, marketDiv.querySelector("button[onclick='closeMarket()']"));
